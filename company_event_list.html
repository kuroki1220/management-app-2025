<!DOCTYPE html>
<html lang="Jp">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>就活管理アプリ - 企業/イベント一覧</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0; /* ヘッダーを考慮し、bodyのmarginをリセット */
            padding: 20px; /* ヘッダーとの間隔 */
            /* ここから背景画像に関する追加 */
            background-image: url('https://azp2.sakuraweb.com/kakou/aozora/sample1.jpg'); /* ★ここにWeb上の画像URLを貼り付けます */
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            background-color: #f4f7f6; /* フォールバックカラー、画像が見つからない場合や読み込み中の背景色 */
            color: #333;
        }
        h1 { /* このH1はページ固有のものなので残します */
            color: #333;
        }
        .company-group {
            margin-bottom: 30px;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 8px;
            background-color: #f9f9f9;
        }
        .company-group h2 {
            margin-top: 0;
            color: #3A6EA5;
            border-bottom: 2px solid #3A6EA5;
            padding-bottom: 5px;
            margin-bottom: 15px;
        }
        .event-item {
            background-color: #fff;
            border: 1px solid #eee;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 4px;
        }
        .event-item p {
            margin: 5px 0;
        }
        .event-item a {
            color: #3A6EA5;
            text-decoration: none;
        }
        .event-item a:hover {
            text-decoration: underline;
        }
        #noEventsMessage {
            font-style: italic;
            color: #666;
        }
    </style>
</head>
<body>
    <div id="header-placeholder"></div> <main>
        <h1>企業/イベント一覧</h1>
        <div id="companyEventList">
            <p id="noEventsMessage">まだ企業やイベントは登録されていません。</p>
        </div>
    </main>

    <script>
        // 共通ヘッダーを読み込むスクリプト
        fetch('header.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('header-placeholder').innerHTML = data;
            });

        document.addEventListener('DOMContentLoaded', () => {
            const companyEventListDiv = document.getElementById('companyEventList');
            const noEventsMessage = document.getElementById('noEventsMessage');
            
            function loadEventsForDisplay() {
                const storedEvents = localStorage.getItem('events'); // キーは 'events'
                return storedEvents ? JSON.parse(storedEvents) : [];
            }

            const events = loadEventsForDisplay();

            if (events.length === 0) {
                noEventsMessage.style.display = 'block'; // メッセージを表示
                return;
            } else {
                noEventsMessage.style.display = 'none'; // メッセージを非表示
            }

            // 企業名/イベント名でグループ化
            const groupedEvents = events.reduce((acc, event) => {
                const name = event.name;
                if (!acc[name]) {
                    acc[name] = [];
                }
                acc[name].push(event);
                return acc;
            }, {});

            // グループごとに表示
            for (const companyName in groupedEvents) {
                const companyGroupDiv = document.createElement('div');
                companyGroupDiv.classList.add('company-group');

                const companyTitle = document.createElement('h2');
                companyTitle.textContent = companyName;
                companyGroupDiv.appendChild(companyTitle);

                // その企業のイベントを日付順にソートして表示
                // 日付だけでなく、開始時間も考慮してソートするように変更
                groupedEvents[companyName].sort((a, b) => {
                    const dateTimeA = new Date(`${a.date}T${a.startTime || '00:00'}`);
                    const dateTimeB = new Date(`${b.date}T${b.startTime || '00:00'}`);
                    return dateTimeA - dateTimeB;
                });


                groupedEvents[companyName].forEach(event => {
                    const eventItem = document.createElement('div');
                    eventItem.classList.add('event-item');

                    const eventDateEl = document.createElement('p');
                    // ★修正: 時間も表示する
                    let timeDisplay = '';
                    if (event.startTime && event.endTime) {
                        timeDisplay = ` ${event.startTime} - ${event.endTime}`;
                    } else if (event.startTime) {
                        timeDisplay = ` ${event.startTime}`;
                    } else if (event.endTime) {
                        timeDisplay = ` ~ ${event.endTime}`;
                    }
                    eventDateEl.textContent = `日付: ${event.date}${timeDisplay}`;
                    eventItem.appendChild(eventDateEl);

                    const eventDetailsEl = document.createElement('p');
                    eventDetailsEl.textContent = `詳細: ${event.details || 'なし'}`;
                    eventItem.appendChild(eventDetailsEl);

                    if (event.url) {
                        const eventUrlEl = document.createElement('p');
                        const urlLink = document.createElement('a');
                        let formattedUrl = event.url;
                        if (!/^https?:\/\//i.test(formattedUrl)) {
                            formattedUrl = 'http://' + formattedUrl;
                        }
                        urlLink.href = formattedUrl;
                        urlLink.textContent = '企業ホームページへアクセス';
                        urlLink.target = '_blank';
                        urlLink.rel = 'noopener noreferrer';
                        eventUrlEl.appendChild(urlLink);
                        eventItem.appendChild(eventUrlEl);
                    }
                    companyGroupDiv.appendChild(eventItem);
                });
                companyEventListDiv.appendChild(companyGroupDiv);
            }
        });
    </script>
</body>
</html>